{
    "sourceFile": "frontend/src/pages/preferences/NotificationPreferences.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767980354159,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767980354159,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport { Search, Save, Bell, Mail, Package } from 'lucide-react';\r\nimport {\r\n  Card,\r\n  Input,\r\n  Table,\r\n  ToggleSwitch,\r\n  LoadingSpinner,\r\n  Button,\r\n} from '../../components/ui';\r\nimport { useAuthStore } from '../../store/authStore';\r\nimport { useUserStore } from '../../store/userStore';\r\nimport { usePreferenceStore } from '../../store/preferenceStore';\r\nimport type { NotificationPreference, User } from '../../types';\r\n\r\ninterface UserWithPreferences extends User {\r\n  preferences: NotificationPreference;\r\n}\r\n\r\nexport const NotificationPreferences: React.FC = () => {\r\n  const { hasPermission } = useAuthStore();\r\n  const { users, setUsers } = useUserStore();\r\n  const { preferences, setPreferences, updatePreference } = usePreferenceStore();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [changedUsers, setChangedUsers] = useState<Set<string>>(new Set());\r\n\r\n  const canUpdate = hasPermission('preferences', 'update');\r\n\r\n  useEffect(() => {\r\n    // Mock data load\r\n    setTimeout(() => {\r\n      const mockUsers: User[] = [\r\n        {\r\n          user_id: '1',\r\n          name: 'Amit Kumar',\r\n          email: 'amit@example.com',\r\n          phone: '9999999999',\r\n          city: 'Delhi',\r\n          is_active: true,\r\n        },\r\n        {\r\n          user_id: '2',\r\n          name: 'Riya Sharma',\r\n          email: 'riya@example.com',\r\n          phone: '8888888888',\r\n          city: 'Mumbai',\r\n          is_active: true,\r\n        },\r\n        {\r\n          user_id: '3',\r\n          name: 'Priya Singh',\r\n          email: 'priya@example.com',\r\n          phone: '7777777777',\r\n          city: 'Bangalore',\r\n          is_active: false,\r\n        },\r\n        {\r\n          user_id: '4',\r\n          name: 'Raj Patel',\r\n          email: 'raj@example.com',\r\n          phone: '6666666666',\r\n          city: 'Delhi',\r\n          is_active: true,\r\n        },\r\n      ];\r\n      setUsers(mockUsers);\r\n\r\n      const mockPreferences: NotificationPreference[] = [\r\n        { user_id: '1', offers: true, order_updates: true, newsletter: false },\r\n        { user_id: '2', offers: false, order_updates: true, newsletter: true },\r\n        { user_id: '3', offers: true, order_updates: false, newsletter: false },\r\n        { user_id: '4', offers: true, order_updates: true, newsletter: true },\r\n      ];\r\n      setPreferences(mockPreferences);\r\n\r\n      setIsLoading(false);\r\n    }, 800);\r\n  }, [setUsers, setPreferences]);\r\n\r\n  const handlePreferenceChange = (\r\n    userId: string,\r\n    type: keyof NotificationPreference,\r\n    value: boolean\r\n  ) => {\r\n    updatePreference(userId, { [type]: value });\r\n    setChangedUsers(new Set([...changedUsers, userId]));\r\n  };\r\n\r\n  const handleSave = () => {\r\n    // Mock save - Replace with actual API call\r\n    console.log('Saving preferences for users:', Array.from(changedUsers));\r\n    setChangedUsers(new Set());\r\n    alert('Preferences saved successfully!');\r\n  };\r\n\r\n  const usersWithPreferences: UserWithPreferences[] = users\r\n    .filter((user) =>\r\n      user.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      user.email.toLowerCase().includes(searchQuery.toLowerCase())\r\n    )\r\n    .map((user) => ({\r\n      ...user,\r\n      preferences: preferences[user.user_id] || {\r\n        user_id: user.user_id,\r\n        offers: false,\r\n        order_updates: false,\r\n        newsletter: false,\r\n      },\r\n    }));\r\n\r\n  const columns = [\r\n    {\r\n      key: 'user',\r\n      header: 'User',\r\n      render: (user: UserWithPreferences) => (\r\n        <div>\r\n          <div className=\"font-medium text-gray-900\">{user.name}</div>\r\n          <div className=\"text-sm text-gray-500\">{user.email}</div>\r\n        </div>\r\n      ),\r\n      width: '30%',\r\n    },\r\n    {\r\n      key: 'offers',\r\n      header: (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Bell className=\"w-4 h-4 text-orange-500\" />\r\n          <span>Promotional Offers</span>\r\n        </div>\r\n      ),\r\n      render: (user: UserWithPreferences) => (\r\n        <div className=\"flex items-center justify-center\">\r\n          <ToggleSwitch\r\n            checked={user.preferences.offers}\r\n            onChange={(value) =>\r\n              handlePreferenceChange(user.user_id, 'offers', value)\r\n            }\r\n            disabled={!canUpdate}\r\n          />\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'order_updates',\r\n      header: (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Package className=\"w-4 h-4 text-blue-500\" />\r\n          <span>Order Updates</span>\r\n        </div>\r\n      ),\r\n      render: (user: UserWithPreferences) => (\r\n        <div className=\"flex items-center justify-center\">\r\n          <ToggleSwitch\r\n            checked={user.preferences.order_updates}\r\n            onChange={(value) =>\r\n              handlePreferenceChange(user.user_id, 'order_updates', value)\r\n            }\r\n            disabled={!canUpdate}\r\n          />\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'newsletter',\r\n      header: (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Mail className=\"w-4 h-4 text-green-500\" />\r\n          <span>Newsletter</span>\r\n        </div>\r\n      ),\r\n      render: (user: UserWithPreferences) => (\r\n        <div className=\"flex items-center justify-center\">\r\n          <ToggleSwitch\r\n            checked={user.preferences.newsletter}\r\n            onChange={(value) =>\r\n              handlePreferenceChange(user.user_id, 'newsletter', value)\r\n            }\r\n            disabled={!canUpdate}\r\n          />\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-96\">\r\n        <LoadingSpinner size=\"lg\" text=\"Loading preferences...\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">Notification Preferences</h1>\r\n          <p className=\"text-gray-600 mt-1\">\r\n            Manage user notification preferences and opt-ins\r\n          </p>\r\n        </div>\r\n        {canUpdate && changedUsers.size > 0 && (\r\n          <Button\r\n            onClick={handleSave}\r\n            variant=\"success\"\r\n            icon={<Save className=\"w-5 h-5\" />}\r\n          >\r\n            Save Changes ({changedUsers.size})\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Info Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n        <Card className=\"p-6 bg-gradient-to-br from-orange-50 to-white border-orange-200\">\r\n          <div className=\"flex items-center gap-3 mb-2\">\r\n            <div className=\"p-2 bg-orange-100 rounded-lg\">\r\n              <Bell className=\"w-5 h-5 text-orange-600\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-gray-900\">Promotional Offers</h3>\r\n          </div>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Special deals, discounts, and exclusive offers\r\n          </p>\r\n          <div className=\"mt-3 text-2xl font-bold text-orange-600\">\r\n            {\r\n              usersWithPreferences.filter((u) => u.preferences.offers).length\r\n            }{' '}\r\n            <span className=\"text-sm font-normal text-gray-600\">opted in</span>\r\n          </div>\r\n        </Card>\r\n\r\n        <Card className=\"p-6 bg-gradient-to-br from-blue-50 to-white border-blue-200\">\r\n          <div className=\"flex items-center gap-3 mb-2\">\r\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\r\n              <Package className=\"w-5 h-5 text-blue-600\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-gray-900\">Order Updates</h3>\r\n          </div>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Shipping, delivery, and order status notifications\r\n          </p>\r\n          <div className=\"mt-3 text-2xl font-bold text-blue-600\">\r\n            {\r\n              usersWithPreferences.filter((u) => u.preferences.order_updates).length\r\n            }{' '}\r\n            <span className=\"text-sm font-normal text-gray-600\">opted in</span>\r\n          </div>\r\n        </Card>\r\n\r\n        <Card className=\"p-6 bg-gradient-to-br from-green-50 to-white border-green-200\">\r\n          <div className=\"flex items-center gap-3 mb-2\">\r\n            <div className=\"p-2 bg-green-100 rounded-lg\">\r\n              <Mail className=\"w-5 h-5 text-green-600\" />\r\n            </div>\r\n            <h3 className=\"font-semibold text-gray-900\">Newsletter</h3>\r\n          </div>\r\n          <p className=\"text-sm text-gray-600\">\r\n            Weekly digest, company news, and product updates\r\n          </p>\r\n          <div className=\"mt-3 text-2xl font-bold text-green-600\">\r\n            {\r\n              usersWithPreferences.filter((u) => u.preferences.newsletter).length\r\n            }{' '}\r\n            <span className=\"text-sm font-normal text-gray-600\">opted in</span>\r\n          </div>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <Card>\r\n        <div className=\"p-6\">\r\n          <Input\r\n            placeholder=\"Search users by name or email...\"\r\n            icon={<Search className=\"w-5 h-5\" />}\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n          />\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Preferences Table */}\r\n      <Card>\r\n        <Table\r\n          data={usersWithPreferences}\r\n          columns={columns}\r\n          emptyMessage=\"No users found\"\r\n        />\r\n      </Card>\r\n\r\n      {!canUpdate && (\r\n        <div className=\"p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800 text-sm\">\r\n          <p className=\"font-medium\">Read-only mode</p>\r\n          <p>You don't have permission to update preferences.</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n"
        }
    ]
}