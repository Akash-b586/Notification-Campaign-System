{
    "sourceFile": "frontend/src/pages/logs/NotificationLogs.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1767980354549,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767980415739,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n   LoadingSpinner,\r\n   Select,\r\n } from '../../components/ui';\r\n import { useAuthStore } from '../../store/authStore';\r\n-import type { NotificationLog } from '../../types';\r\n+import type { NotificationLog } from '../../';\r\n \r\n export const NotificationLogs: React.FC = () => {\r\n   const { hasPermission } = useAuthStore();\r\n   const [logs, setLogs] = useState<NotificationLog[]>([]);\r\n"
                },
                {
                    "date": 1767980421025,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,246 @@\n+import React, { useState, useEffect } from 'react';\r\n+import { Search, Download } from 'lucide-react';\r\n+import {\r\n+  Button,\r\n+  Card,\r\n+  Input,\r\n+  Table,\r\n+  Badge,\r\n+  LoadingSpinner,\r\n+  Select,\r\n+} from '../../components/ui';\r\n+import { useAuthStore } from '../../store/authStore';\r\n+import type { NotificationLog } from '../../types';\r\n+\r\n+export const NotificationLogs: React.FC = () => {\r\n+  const { hasPermission } = useAuthStore();\r\n+  const [logs, setLogs] = useState<NotificationLog[]>([]);\r\n+  const [searchQuery, setSearchQuery] = useState('');\r\n+  const [statusFilter, setStatusFilter] = useState('');\r\n+  const [campaignFilter, setCampaignFilter] = useState('');\r\n+  const [isLoading, setIsLoading] = useState(true);\r\n+\r\n+  const canDownload = hasPermission('logs', 'download');\r\n+\r\n+  useEffect(() => {\r\n+    setTimeout(() => {\r\n+      const mockLogs: NotificationLog[] = [\r\n+        {\r\n+          log_id: '1',\r\n+          user_id: '1',\r\n+          campaign_id: '1',\r\n+          campaign_name: 'Diwali Offers 2026',\r\n+          user_name: 'Amit Kumar',\r\n+          user_email: 'amit@example.com',\r\n+          sent_at: '2026-01-05T10:05:23Z',\r\n+          status: 'success',\r\n+        },\r\n+        {\r\n+          log_id: '2',\r\n+          user_id: '2',\r\n+          campaign_id: '1',\r\n+          campaign_name: 'Diwali Offers 2026',\r\n+          user_name: 'Riya Sharma',\r\n+          user_email: 'riya@example.com',\r\n+          sent_at: '2026-01-05T10:05:24Z',\r\n+          status: 'success',\r\n+        },\r\n+        {\r\n+          log_id: '3',\r\n+          user_id: '4',\r\n+          campaign_id: '1',\r\n+          campaign_name: 'Diwali Offers 2026',\r\n+          user_name: 'Raj Patel',\r\n+          user_email: 'raj@example.com',\r\n+          sent_at: '2026-01-05T10:05:25Z',\r\n+          status: 'failed',\r\n+        },\r\n+      ];\r\n+      setLogs(mockLogs);\r\n+      setIsLoading(false);\r\n+    }, 800);\r\n+  }, []);\r\n+\r\n+  const filteredLogs = logs.filter((log) => {\r\n+    const matchesSearch =\r\n+      log.user_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n+      log.user_email?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n+      log.campaign_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n+      log.log_id.toLowerCase().includes(searchQuery.toLowerCase());\r\n+\r\n+    const matchesStatus = !statusFilter || log.status === statusFilter;\r\n+    const matchesCampaign = !campaignFilter || log.campaign_id === campaignFilter;\r\n+\r\n+    return matchesSearch && matchesStatus && matchesCampaign;\r\n+  });\r\n+\r\n+  const handleDownloadCSV = () => {\r\n+    const csvContent = [\r\n+      'Log ID,User ID,User Name,User Email,Campaign ID,Campaign Name,Sent At,Status',\r\n+      ...filteredLogs.map((log) =>\r\n+        [\r\n+          log.log_id,\r\n+          log.user_id,\r\n+          log.user_name,\r\n+          log.user_email,\r\n+          log.campaign_id,\r\n+          log.campaign_name,\r\n+          log.sent_at,\r\n+          log.status,\r\n+        ].join(',')\r\n+      ),\r\n+    ].join('\\n');\r\n+\r\n+    const blob = new Blob([csvContent], { type: 'text/csv' });\r\n+    const url = window.URL.createObjectURL(blob);\r\n+    const a = document.createElement('a');\r\n+    a.href = url;\r\n+    a.download = `notification-logs-${new Date().toISOString().split('T')[0]}.csv`;\r\n+    a.click();\r\n+  };\r\n+\r\n+  const uniqueCampaigns = Array.from(new Set(logs.map((l) => l.campaign_id))).map((id) => {\r\n+    const log = logs.find((l) => l.campaign_id === id);\r\n+    return { value: id, label: log?.campaign_name || id };\r\n+  });\r\n+\r\n+  const successCount = logs.filter((l) => l.status === 'success').length;\r\n+  const failedCount = logs.filter((l) => l.status === 'failed').length;\r\n+  const successRate = logs.length > 0 ? ((successCount / logs.length) * 100).toFixed(1) : '0';\r\n+\r\n+  const columns = [\r\n+    {\r\n+      key: 'log_id',\r\n+      header: 'Log ID',\r\n+      render: (log: NotificationLog) => (\r\n+        <span className=\"font-mono text-sm text-gray-600\">{log.log_id}</span>\r\n+      ),\r\n+    },\r\n+    {\r\n+      key: 'user',\r\n+      header: 'User',\r\n+      render: (log: NotificationLog) => (\r\n+        <div>\r\n+          <div className=\"font-medium text-gray-900\">{log.user_name}</div>\r\n+          <div className=\"text-sm text-gray-500\">{log.user_email}</div>\r\n+        </div>\r\n+      ),\r\n+    },\r\n+    {\r\n+      key: 'campaign',\r\n+      header: 'Campaign',\r\n+      render: (log: NotificationLog) => (\r\n+        <div>\r\n+          <div className=\"font-medium text-gray-900\">{log.campaign_name}</div>\r\n+          <div className=\"text-sm text-gray-500 font-mono\">{log.campaign_id}</div>\r\n+        </div>\r\n+      ),\r\n+    },\r\n+    {\r\n+      key: 'sent_at',\r\n+      header: 'Sent At',\r\n+      render: (log: NotificationLog) => (\r\n+        <div>\r\n+          <div className=\"text-sm text-gray-900\">\r\n+            {new Date(log.sent_at).toLocaleDateString()}\r\n+          </div>\r\n+          <div className=\"text-xs text-gray-500\">\r\n+            {new Date(log.sent_at).toLocaleTimeString()}\r\n+          </div>\r\n+        </div>\r\n+      ),\r\n+    },\r\n+    {\r\n+      key: 'status',\r\n+      header: 'Status',\r\n+      render: (log: NotificationLog) => (\r\n+        <Badge variant={log.status === 'success' ? 'success' : 'error'}>\r\n+          {log.status}\r\n+        </Badge>\r\n+      ),\r\n+    },\r\n+  ];\r\n+\r\n+  if (isLoading) {\r\n+    return (\r\n+      <div className=\"flex items-center justify-center h-96\">\r\n+        <LoadingSpinner size=\"lg\" text=\"Loading logs...\" />\r\n+      </div>\r\n+    );\r\n+  }\r\n+\r\n+  return (\r\n+    <div className=\"space-y-6\">\r\n+      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n+        <div>\r\n+          <h1 className=\"text-3xl font-bold text-gray-900\">Notification Logs</h1>\r\n+          <p className=\"text-gray-600 mt-1\">Track and audit all notification activities</p>\r\n+        </div>\r\n+        {canDownload && (\r\n+          <Button\r\n+            onClick={handleDownloadCSV}\r\n+            variant=\"outline\"\r\n+            icon={<Download className=\"w-5 h-5\" />}\r\n+          >\r\n+            Export Logs\r\n+          </Button>\r\n+        )}\r\n+      </div>\r\n+\r\n+      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n+        <Card className=\"p-6\">\r\n+          <div className=\"text-sm text-gray-600 mb-1\">Total Notifications</div>\r\n+          <div className=\"text-3xl font-bold text-gray-900\">{logs.length}</div>\r\n+        </Card>\r\n+        <Card className=\"p-6\">\r\n+          <div className=\"text-sm text-gray-600 mb-1\">Successful</div>\r\n+          <div className=\"text-3xl font-bold text-green-600\">{successCount}</div>\r\n+        </Card>\r\n+        <Card className=\"p-6\">\r\n+          <div className=\"text-sm text-gray-600 mb-1\">Failed</div>\r\n+          <div className=\"text-3xl font-bold text-red-600\">{failedCount}</div>\r\n+        </Card>\r\n+        <Card className=\"p-6\">\r\n+          <div className=\"text-sm text-gray-600 mb-1\">Success Rate</div>\r\n+          <div className=\"text-3xl font-bold text-primary-600\">{successRate}%</div>\r\n+        </Card>\r\n+      </div>\r\n+\r\n+      <Card>\r\n+        <div className=\"p-6\">\r\n+          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n+            <div className=\"md:col-span-1\">\r\n+              <Input\r\n+                placeholder=\"Search logs...\"\r\n+                icon={<Search className=\"w-5 h-5\" />}\r\n+                value={searchQuery}\r\n+                onChange={(e) => setSearchQuery(e.target.value)}\r\n+              />\r\n+            </div>\r\n+            <Select\r\n+              options={[\r\n+                { value: '', label: 'All Campaigns' },\r\n+                ...uniqueCampaigns,\r\n+              ]}\r\n+              value={campaignFilter}\r\n+              onChange={(e) => setCampaignFilter(e.target.value)}\r\n+            />\r\n+            <Select\r\n+              options={[\r\n+                { value: '', label: 'All Status' },\r\n+                { value: 'success', label: 'Success' },\r\n+                { value: 'failed', label: 'Failed' },\r\n+              ]}\r\n+              value={statusFilter}\r\n+              onChange={(e) => setStatusFilter(e.target.value)}\r\n+            />\r\n+          </div>\r\n+        </div>\r\n+      </Card>\r\n+\r\n+      <Card>\r\n+        <Table data={filteredLogs} columns={columns} emptyMessage=\"No logs found\" />\r\n+      </Card>\r\n+    </div>\r\n+  );\r\n+};\r\n"
                }
            ],
            "date": 1767980354549,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport { Search, Download } from 'lucide-react';\r\nimport {\r\n  Button,\r\n  Card,\r\n  Input,\r\n  Table,\r\n  Badge,\r\n  LoadingSpinner,\r\n  Select,\r\n} from '../../components/ui';\r\nimport { useAuthStore } from '../../store/authStore';\r\nimport type { NotificationLog } from '../../types';\r\n\r\nexport const NotificationLogs: React.FC = () => {\r\n  const { hasPermission } = useAuthStore();\r\n  const [logs, setLogs] = useState<NotificationLog[]>([]);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('');\r\n  const [campaignFilter, setCampaignFilter] = useState('');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  const canDownload = hasPermission('logs', 'download');\r\n\r\n  useEffect(() => {\r\n    setTimeout(() => {\r\n      const mockLogs: NotificationLog[] = [\r\n        {\r\n          log_id: '1',\r\n          user_id: '1',\r\n          campaign_id: '1',\r\n          campaign_name: 'Diwali Offers 2026',\r\n          user_name: 'Amit Kumar',\r\n          user_email: 'amit@example.com',\r\n          sent_at: '2026-01-05T10:05:23Z',\r\n          status: 'success',\r\n        },\r\n        {\r\n          log_id: '2',\r\n          user_id: '2',\r\n          campaign_id: '1',\r\n          campaign_name: 'Diwali Offers 2026',\r\n          user_name: 'Riya Sharma',\r\n          user_email: 'riya@example.com',\r\n          sent_at: '2026-01-05T10:05:24Z',\r\n          status: 'success',\r\n        },\r\n        {\r\n          log_id: '3',\r\n          user_id: '4',\r\n          campaign_id: '1',\r\n          campaign_name: 'Diwali Offers 2026',\r\n          user_name: 'Raj Patel',\r\n          user_email: 'raj@example.com',\r\n          sent_at: '2026-01-05T10:05:25Z',\r\n          status: 'failed',\r\n        },\r\n      ];\r\n      setLogs(mockLogs);\r\n      setIsLoading(false);\r\n    }, 800);\r\n  }, []);\r\n\r\n  const filteredLogs = logs.filter((log) => {\r\n    const matchesSearch =\r\n      log.user_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      log.user_email?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      log.campaign_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      log.log_id.toLowerCase().includes(searchQuery.toLowerCase());\r\n\r\n    const matchesStatus = !statusFilter || log.status === statusFilter;\r\n    const matchesCampaign = !campaignFilter || log.campaign_id === campaignFilter;\r\n\r\n    return matchesSearch && matchesStatus && matchesCampaign;\r\n  });\r\n\r\n  const handleDownloadCSV = () => {\r\n    const csvContent = [\r\n      'Log ID,User ID,User Name,User Email,Campaign ID,Campaign Name,Sent At,Status',\r\n      ...filteredLogs.map((log) =>\r\n        [\r\n          log.log_id,\r\n          log.user_id,\r\n          log.user_name,\r\n          log.user_email,\r\n          log.campaign_id,\r\n          log.campaign_name,\r\n          log.sent_at,\r\n          log.status,\r\n        ].join(',')\r\n      ),\r\n    ].join('\\n');\r\n\r\n    const blob = new Blob([csvContent], { type: 'text/csv' });\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `notification-logs-${new Date().toISOString().split('T')[0]}.csv`;\r\n    a.click();\r\n  };\r\n\r\n  const uniqueCampaigns = Array.from(new Set(logs.map((l) => l.campaign_id))).map((id) => {\r\n    const log = logs.find((l) => l.campaign_id === id);\r\n    return { value: id, label: log?.campaign_name || id };\r\n  });\r\n\r\n  const successCount = logs.filter((l) => l.status === 'success').length;\r\n  const failedCount = logs.filter((l) => l.status === 'failed').length;\r\n  const successRate = logs.length > 0 ? ((successCount / logs.length) * 100).toFixed(1) : '0';\r\n\r\n  const columns = [\r\n    {\r\n      key: 'log_id',\r\n      header: 'Log ID',\r\n      render: (log: NotificationLog) => (\r\n        <span className=\"font-mono text-sm text-gray-600\">{log.log_id}</span>\r\n      ),\r\n    },\r\n    {\r\n      key: 'user',\r\n      header: 'User',\r\n      render: (log: NotificationLog) => (\r\n        <div>\r\n          <div className=\"font-medium text-gray-900\">{log.user_name}</div>\r\n          <div className=\"text-sm text-gray-500\">{log.user_email}</div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'campaign',\r\n      header: 'Campaign',\r\n      render: (log: NotificationLog) => (\r\n        <div>\r\n          <div className=\"font-medium text-gray-900\">{log.campaign_name}</div>\r\n          <div className=\"text-sm text-gray-500 font-mono\">{log.campaign_id}</div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'sent_at',\r\n      header: 'Sent At',\r\n      render: (log: NotificationLog) => (\r\n        <div>\r\n          <div className=\"text-sm text-gray-900\">\r\n            {new Date(log.sent_at).toLocaleDateString()}\r\n          </div>\r\n          <div className=\"text-xs text-gray-500\">\r\n            {new Date(log.sent_at).toLocaleTimeString()}\r\n          </div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'status',\r\n      header: 'Status',\r\n      render: (log: NotificationLog) => (\r\n        <Badge variant={log.status === 'success' ? 'success' : 'error'}>\r\n          {log.status}\r\n        </Badge>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-96\">\r\n        <LoadingSpinner size=\"lg\" text=\"Loading logs...\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">Notification Logs</h1>\r\n          <p className=\"text-gray-600 mt-1\">Track and audit all notification activities</p>\r\n        </div>\r\n        {canDownload && (\r\n          <Button\r\n            onClick={handleDownloadCSV}\r\n            variant=\"outline\"\r\n            icon={<Download className=\"w-5 h-5\" />}\r\n          >\r\n            Export Logs\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n        <Card className=\"p-6\">\r\n          <div className=\"text-sm text-gray-600 mb-1\">Total Notifications</div>\r\n          <div className=\"text-3xl font-bold text-gray-900\">{logs.length}</div>\r\n        </Card>\r\n        <Card className=\"p-6\">\r\n          <div className=\"text-sm text-gray-600 mb-1\">Successful</div>\r\n          <div className=\"text-3xl font-bold text-green-600\">{successCount}</div>\r\n        </Card>\r\n        <Card className=\"p-6\">\r\n          <div className=\"text-sm text-gray-600 mb-1\">Failed</div>\r\n          <div className=\"text-3xl font-bold text-red-600\">{failedCount}</div>\r\n        </Card>\r\n        <Card className=\"p-6\">\r\n          <div className=\"text-sm text-gray-600 mb-1\">Success Rate</div>\r\n          <div className=\"text-3xl font-bold text-primary-600\">{successRate}%</div>\r\n        </Card>\r\n      </div>\r\n\r\n      <Card>\r\n        <div className=\"p-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div className=\"md:col-span-1\">\r\n              <Input\r\n                placeholder=\"Search logs...\"\r\n                icon={<Search className=\"w-5 h-5\" />}\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n              />\r\n            </div>\r\n            <Select\r\n              options={[\r\n                { value: '', label: 'All Campaigns' },\r\n                ...uniqueCampaigns,\r\n              ]}\r\n              value={campaignFilter}\r\n              onChange={(e) => setCampaignFilter(e.target.value)}\r\n            />\r\n            <Select\r\n              options={[\r\n                { value: '', label: 'All Status' },\r\n                { value: 'success', label: 'Success' },\r\n                { value: 'failed', label: 'Failed' },\r\n              ]}\r\n              value={statusFilter}\r\n              onChange={(e) => setStatusFilter(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Card>\r\n\r\n      <Card>\r\n        <Table data={filteredLogs} columns={columns} emptyMessage=\"No logs found\" />\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n"
        }
    ]
}