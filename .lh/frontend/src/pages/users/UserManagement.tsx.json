{
    "sourceFile": "frontend/src/pages/users/UserManagement.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767980354156,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767980354156,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Plus,\r\n  Search,\r\n  Upload,\r\n  Trash2,\r\n  Edit,\r\n  Eye,\r\n  FileJson,\r\n  FileText,\r\n} from 'lucide-react';\r\nimport {\r\n  Button,\r\n  Card,\r\n  Input,\r\n  Table,\r\n  Modal,\r\n  ToggleSwitch,\r\n  LoadingSpinner,\r\n  Select,\r\n} from '../../components/ui';\r\nimport { useAuthStore } from '../../store/authStore';\r\nimport { useUserStore } from '../../store/userStore';\r\nimport type { User } from '../../types';\r\n\r\nexport const UserManagement: React.FC = () => {\r\n  const { hasPermission } = useAuthStore();\r\n  const { users, setUsers, addUser, updateUser, deleteUser } = useUserStore();\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [selectedCity, setSelectedCity] = useState('');\r\n  const [showActiveOnly, setShowActiveOnly] = useState(false);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [isBulkModalOpen, setIsBulkModalOpen] = useState(false);\r\n  const [editingUser, setEditingUser] = useState<User | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Form state\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    city: '',\r\n    is_active: true,\r\n  });\r\n\r\n  const [bulkData, setBulkData] = useState('');\r\n  const [bulkType, setBulkType] = useState<'json' | 'csv'>('json');\r\n\r\n  useEffect(() => {\r\n    // Mock data load\r\n    setTimeout(() => {\r\n      const mockUsers: User[] = [\r\n        {\r\n          user_id: '1',\r\n          name: 'Amit Kumar',\r\n          email: 'amit@example.com',\r\n          phone: '9999999999',\r\n          city: 'Delhi',\r\n          is_active: true,\r\n        },\r\n        {\r\n          user_id: '2',\r\n          name: 'Riya Sharma',\r\n          email: 'riya@example.com',\r\n          phone: '8888888888',\r\n          city: 'Mumbai',\r\n          is_active: true,\r\n        },\r\n        {\r\n          user_id: '3',\r\n          name: 'Priya Singh',\r\n          email: 'priya@example.com',\r\n          phone: '7777777777',\r\n          city: 'Bangalore',\r\n          is_active: false,\r\n        },\r\n        {\r\n          user_id: '4',\r\n          name: 'Raj Patel',\r\n          email: 'raj@example.com',\r\n          phone: '6666666666',\r\n          city: 'Delhi',\r\n          is_active: true,\r\n        },\r\n      ];\r\n      setUsers(mockUsers);\r\n      setIsLoading(false);\r\n    }, 800);\r\n  }, [setUsers]);\r\n\r\n  const canCreate = hasPermission('users', 'create');\r\n  const canUpdate = hasPermission('users', 'update');\r\n  const canDelete = hasPermission('users', 'delete');\r\n\r\n  const cities = ['Delhi', 'Mumbai', 'Bangalore', 'Chennai', 'Kolkata', 'Hyderabad'];\r\n\r\n  const handleOpenModal = (user?: User) => {\r\n    if (user) {\r\n      setEditingUser(user);\r\n      setFormData({\r\n        name: user.name,\r\n        email: user.email,\r\n        phone: user.phone || '',\r\n        city: user.city || '',\r\n        is_active: user.is_active,\r\n      });\r\n    } else {\r\n      setEditingUser(null);\r\n      setFormData({\r\n        name: '',\r\n        email: '',\r\n        phone: '',\r\n        city: '',\r\n        is_active: true,\r\n      });\r\n    }\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (editingUser) {\r\n      updateUser(editingUser.user_id, formData);\r\n    } else {\r\n      const newUser: User = {\r\n        user_id: `user-${Date.now()}`,\r\n        ...formData,\r\n      };\r\n      addUser(newUser);\r\n    }\r\n\r\n    setIsModalOpen(false);\r\n  };\r\n\r\n  const handleBulkUpload = () => {\r\n    try {\r\n      if (bulkType === 'json') {\r\n        const data = JSON.parse(bulkData);\r\n        const usersArray = data.users || data;\r\n        usersArray.forEach((user: any) => {\r\n          const newUser: User = {\r\n            user_id: user.user_id || `user-${Date.now()}-${Math.random()}`,\r\n            name: user.name,\r\n            email: user.email,\r\n            phone: user.phone,\r\n            city: user.city,\r\n            is_active: user.is_active !== false,\r\n          };\r\n          addUser(newUser);\r\n        });\r\n      } else {\r\n        // CSV parsing\r\n        const lines = bulkData.trim().split('\\n');\r\n        \r\n        for (let i = 1; i < lines.length; i++) {\r\n          const values = lines[i].split(',');\r\n          const newUser: User = {\r\n            user_id: values[0] || `user-${Date.now()}-${i}`,\r\n            name: values[1],\r\n            email: values[2],\r\n            phone: values[3],\r\n            city: values[4],\r\n            is_active: values[5] !== 'false',\r\n          };\r\n          addUser(newUser);\r\n        }\r\n      }\r\n      setIsBulkModalOpen(false);\r\n      setBulkData('');\r\n    } catch (error) {\r\n      alert('Invalid data format. Please check and try again.');\r\n    }\r\n  };\r\n\r\n  const handleDelete = (userId: string) => {\r\n    if (confirm('Are you sure you want to delete this user?')) {\r\n      deleteUser(userId);\r\n    }\r\n  };\r\n\r\n  const handleToggleActive = (userId: string, isActive: boolean) => {\r\n    updateUser(userId, { is_active: isActive });\r\n  };\r\n\r\n  const filteredUsers = users.filter((user) => {\r\n    const matchesSearch =\r\n      user.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      user.email.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n      user.user_id.toLowerCase().includes(searchQuery.toLowerCase());\r\n\r\n    const matchesCity = !selectedCity || user.city === selectedCity;\r\n    const matchesActive = !showActiveOnly || user.is_active;\r\n\r\n    return matchesSearch && matchesCity && matchesActive;\r\n  });\r\n\r\n  const columns = [\r\n    {\r\n      key: 'user_id',\r\n      header: 'User ID',\r\n      render: (user: User) => (\r\n        <span className=\"font-mono text-sm text-gray-600\">{user.user_id}</span>\r\n      ),\r\n    },\r\n    {\r\n      key: 'name',\r\n      header: 'Name',\r\n      render: (user: User) => (\r\n        <div>\r\n          <div className=\"font-medium text-gray-900\">{user.name}</div>\r\n          <div className=\"text-sm text-gray-500\">{user.email}</div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: 'phone',\r\n      header: 'Phone',\r\n      render: (user: User) => (\r\n        <span className=\"text-gray-600\">{user.phone || '-'}</span>\r\n      ),\r\n    },\r\n    {\r\n      key: 'city',\r\n      header: 'City',\r\n      render: (user: User) => (\r\n        <span className=\"text-gray-600\">{user.city || '-'}</span>\r\n      ),\r\n    },\r\n    {\r\n      key: 'is_active',\r\n      header: 'Status',\r\n      render: (user: User) => (\r\n        <ToggleSwitch\r\n          checked={user.is_active}\r\n          onChange={(checked) => handleToggleActive(user.user_id, checked)}\r\n          disabled={!canUpdate}\r\n        />\r\n      ),\r\n    },\r\n    {\r\n      key: 'actions',\r\n      header: 'Actions',\r\n      render: (user: User) => (\r\n        <div className=\"flex items-center gap-2\">\r\n          {canUpdate ? (\r\n            <button\r\n              onClick={() => handleOpenModal(user)}\r\n              className=\"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors\"\r\n              title=\"Edit\"\r\n            >\r\n              <Edit className=\"w-4 h-4\" />\r\n            </button>\r\n          ) : (\r\n            <button\r\n              onClick={() => handleOpenModal(user)}\r\n              className=\"p-2 text-gray-600 hover:bg-gray-50 rounded-lg transition-colors\"\r\n              title=\"View\"\r\n            >\r\n              <Eye className=\"w-4 h-4\" />\r\n            </button>\r\n          )}\r\n          {canDelete && (\r\n            <button\r\n              onClick={() => handleDelete(user.user_id)}\r\n              className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\r\n              title=\"Delete\"\r\n            >\r\n              <Trash2 className=\"w-4 h-4\" />\r\n            </button>\r\n          )}\r\n        </div>\r\n      ),\r\n      width: '100px',\r\n    },\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-96\">\r\n        <LoadingSpinner size=\"lg\" text=\"Loading users...\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">User Management</h1>\r\n          <p className=\"text-gray-600 mt-1\">Manage users and their information</p>\r\n        </div>\r\n        {canCreate && (\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              onClick={() => setIsBulkModalOpen(true)}\r\n              variant=\"outline\"\r\n              icon={<Upload className=\"w-5 h-5\" />}\r\n            >\r\n              Bulk Upload\r\n            </Button>\r\n            <Button\r\n              onClick={() => handleOpenModal()}\r\n              variant=\"primary\"\r\n              icon={<Plus className=\"w-5 h-5\" />}\r\n            >\r\n              Add User\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <Card>\r\n        <div className=\"p-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <div className=\"md:col-span-2\">\r\n              <Input\r\n                placeholder=\"Search by name, email, or ID...\"\r\n                icon={<Search className=\"w-5 h-5\" />}\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n              />\r\n            </div>\r\n            <Select\r\n              options={[\r\n                { value: '', label: 'All Cities' },\r\n                ...cities.map((city) => ({ value: city, label: city })),\r\n              ]}\r\n              value={selectedCity}\r\n              onChange={(e) => setSelectedCity(e.target.value)}\r\n            />\r\n            <div className=\"flex items-center\">\r\n              <ToggleSwitch\r\n                checked={showActiveOnly}\r\n                onChange={setShowActiveOnly}\r\n                label=\"Active Only\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* Users Table */}\r\n      <Card>\r\n        <Table data={filteredUsers} columns={columns} emptyMessage=\"No users found\" />\r\n      </Card>\r\n\r\n      {/* Create/Edit Modal */}\r\n      <Modal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        title={editingUser ? 'Edit User' : 'Create New User'}\r\n        footer={\r\n          <>\r\n            <Button variant=\"outline\" onClick={() => setIsModalOpen(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              variant=\"primary\"\r\n              onClick={handleSubmit}\r\n              disabled={!canUpdate && !!editingUser}\r\n            >\r\n              {editingUser ? 'Update' : 'Create'}\r\n            </Button>\r\n          </>\r\n        }\r\n      >\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <Input\r\n            label=\"Full Name\"\r\n            value={formData.name}\r\n            onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n            required\r\n            disabled={!canUpdate && !!editingUser}\r\n          />\r\n          <Input\r\n            label=\"Email\"\r\n            type=\"email\"\r\n            value={formData.email}\r\n            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n            required\r\n            disabled={!canUpdate && !!editingUser}\r\n          />\r\n          <Input\r\n            label=\"Phone\"\r\n            type=\"tel\"\r\n            value={formData.phone}\r\n            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n            disabled={!canUpdate && !!editingUser}\r\n          />\r\n          <Select\r\n            label=\"City\"\r\n            options={[\r\n              { value: '', label: 'Select City' },\r\n              ...cities.map((city) => ({ value: city, label: city })),\r\n            ]}\r\n            value={formData.city}\r\n            onChange={(e) => setFormData({ ...formData, city: e.target.value })}\r\n            disabled={!canUpdate && !!editingUser}\r\n          />\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Status</label>\r\n            <ToggleSwitch\r\n              checked={formData.is_active}\r\n              onChange={(checked) => setFormData({ ...formData, is_active: checked })}\r\n              label={formData.is_active ? 'Active' : 'Inactive'}\r\n              disabled={!canUpdate && !!editingUser}\r\n            />\r\n          </div>\r\n        </form>\r\n      </Modal>\r\n\r\n      {/* Bulk Upload Modal */}\r\n      <Modal\r\n        isOpen={isBulkModalOpen}\r\n        onClose={() => setIsBulkModalOpen(false)}\r\n        title=\"Bulk Upload Users\"\r\n        size=\"lg\"\r\n        footer={\r\n          <>\r\n            <Button variant=\"outline\" onClick={() => setIsBulkModalOpen(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button variant=\"primary\" onClick={handleBulkUpload}>\r\n              Upload\r\n            </Button>\r\n          </>\r\n        }\r\n      >\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              variant={bulkType === 'json' ? 'primary' : 'outline'}\r\n              onClick={() => setBulkType('json')}\r\n              icon={<FileJson className=\"w-4 h-4\" />}\r\n              size=\"sm\"\r\n            >\r\n              JSON\r\n            </Button>\r\n            <Button\r\n              variant={bulkType === 'csv' ? 'primary' : 'outline'}\r\n              onClick={() => setBulkType('csv')}\r\n              icon={<FileText className=\"w-4 h-4\" />}\r\n              size=\"sm\"\r\n            >\r\n              CSV\r\n            </Button>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n              Paste your {bulkType.toUpperCase()} data\r\n            </label>\r\n            <textarea\r\n              className=\"w-full h-64 p-4 border border-gray-300 rounded-lg font-mono text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent\"\r\n              placeholder={\r\n                bulkType === 'json'\r\n                  ? '{\\n  \"users\": [\\n    {\\n      \"user_id\": \"12345\",\\n      \"name\": \"Amit\",\\n      \"email\": \"amit@test.com\",\\n      \"city\": \"Delhi\"\\n    }\\n  ]\\n}'\r\n                  : 'user_id,name,email,phone,city,is_active\\n12345,Amit,amit@test.com,9999999999,Delhi,true'\r\n              }\r\n              value={bulkData}\r\n              onChange={(e) => setBulkData(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n"
        }
    ]
}